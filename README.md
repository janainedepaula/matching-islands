match_islands.py is an in-house Python pipeline for comparative analysis and network construction of genomic islands (e.g. virulence/pathogenicicty, resistance, symbiotic or metabolic islands) predicted by GIPSy2. The pipeline performs protein-level, sequence-based comparisons between islands across multiple bacterial strains and generates outputs ready for downstream interpretation and visualization in Cytoscape. Plus, the pipeline supports scalable analysis of pathogenicity island similarity, clustering, and directional gene coverage across large genomic datasets.

The main goal of match-islands is to:
- Compare genomic islands across two or more strains using protein sequence similarity;
- Identify shared, partially related, and exclusive islands;
- Generate interpretable summaries and similarity networks for exploratory and comparative genomics analyses.

This pipeline analyzes outputs generated by **GIPSy2** (Genomic Island Prediction Software 2).
It does not modify or redistribute any code from GIPSy2.

Please ensure you have run GIPSy2 and generated the relevant genomic island outputs before using this pipeline.

Original software:
Rodrigues, D. L. N., Azevedo, V. A. de C., Soares, S. de C., & Aburjaile, F. F. (2024â€“2025). GIPSy2 - Genomic Island Prediction Software 2 (2.0.7). Zenodo. https://doi.org/10.5281/zenodo.14969252

# RUNNING - Important!!
You need to download "scripts" folder and the match_islands.py of interest to run. You can choose from: 
- If you want to compare pathogenicity islands, please choose "pathogenicity_match_islands.py" to run. 
- If you want to compare resistance islands, please choose "resistance_match_islands.py" to run. 

# How the pipeline works?
1. Input detection: The script must be placed inside a directory containing the folders of interest (in the same directory of LineageName_Islands_fisher/ folders). The script automatically searches for GIPSy2 amino acid outputs following the structure (e.g. for Pathogenicity Islands):
LineageName_Islands_fisher/
   â””â”€â”€ Amino_acids/
       â””â”€â”€ Virulence_Island_*.faa
All .faa files found are stored internally and compared in a pairwise manner.

2. Protein-level sequence alignment: For each unique pair of island files, all protein sequences will be read using Bio.SeqIO, by Biopython and then, each protein from "Island A" is aligned against all proteins from "Island B", using  Bio.Align.PairwiseAligner. In the global mode, match_score = 1; mismatch_score = 0. So, in this way, sequence identity is calculated as "identity = number of matches / length of the longest sequence". This alighnment is perform at protein level and this approach ensures true sequence-based comparison, independent of annotation inconsistencies.

3. Best-hit selection and identity thresholds: For each protein, only the best match in the target island is retained. Each one of those matches are classified using a default identity threshold such as "High similarity" as â‰¥ 90% and "Low similarity" as < 90%. Thresholds can be easily adjusted within the script.

4. Parallel processing: Pairwise comparisons are computationally expensive. In this sense, to improve performance, the pipeline uses "multiprocessing.Pool", that automatically detects the number of available CPU cores to use. This makes the pipeline suitable for datasets with dozens of strains and islands. Also, alignment is computationally expensive so I recommend run using screen or tmux on Linux.
   
5. Similarity network construction: From the pairwise comparison summaries, the pipeline will extract average similarity values and classify island relationships into three categories: High (â‰¥ 90%) or Medium (50â€“89%) or Low (< 50%). This analyse will be export to a CSV file compatible with Cytoscape with node names are automatically simplified to improve network readability.

6. Global summary: A final report is generated containing number of strains analyzed, total number of islands, number of islands per strain and distribution of similarity levels in the network. 

# Output files
After execution, the following files are produced:
- "comparison_results_summary.txt": Pairwise summaries including average similarity and unmatched genes;
- "cytoscape_network_classified.csv": Similarity network file for Cytoscape with original names of islands and lineages;
- "renamed_cytoscape_network_classified.csv": Network file with simplified names (best for cytoscape analysis);
- "global_analysis_summary.txt": Global overview of the analysis;
- "island_pairwise_coverage.csv": Includes the information of fraction of genes from island A covered by island B and vice-versa.

# Optional analysis: --plot flag for coverage
- The scripts/plot_directional_coverage.py takes "island_pairwise_coverage.csv" as input and generates a hexbin density plot showing the relationship between directional coverage values:
   - X-axis: Fraction of genes from island A covered by island B  
   - Y-axis: Fraction of genes from island B covered by island A
- The resulting figure highlights the highly symmetric island pairs (values close to the diagonal), asymmetric coverage patterns and dense regions corresponding to frequently observed coverage combinations across the dataset.

The generation of the directional coverage figure is optional and can be enabled using the "--plot" flag when running the main pipeline (e.g. python3 pathogenicity_match_islands.py --plot).

# Dependencies 
Python â‰¥ 3 and libraries:
- Bio.SeqIO: Reading FASTA and .faa files. 
- Bio.Align.PairwiseAligner: Pairwise global alignment.
- os, pathlib: Directory and file handling.
- collections: Auxiliary data structures.

# ---------
# Optional analysis: Louvain's algorithm for clustering
For large datasets (high number of strains and islands), network visualization and interpretation can become challenging. To address this, match-islands can be complemented with an optional, independent script that applies Louvain community detection to the similarity network. The Louvain algorithm detects communities based on global connectivity patterns, making it particularly suitable for genomic island similarity networks where similarity relationships are not necessarily transitive.

Note: This step is not required for running match_islands.py, but is recommended when working with dense or highly connected networks.

# Louvain clustering - Purpose
- Identify clusters (communities) of highly related islands. 
- Reduce visual complexity in Cytoscape (colored by cluster).
- Facilitate interpretation of large similarity networks.

# Louvain clustering - Running, input and outputs

- Input:"renamed_cytoscape_network_classified.csv"
- Output files:
   - "nodes_with_clusters.csv": list of nodes with assigned Louvain clusters. 
   - "edges_for_cytoscape.csv": edge table ready for Cytoscape import.

# Louvain clustering - dependencies
This script requires the following Python packages:
- pandas
- networkx
- python-louvain

Install dependencies with:
- pip install pandas networkx python-louvain

## License
This repository is licensed under the MIT License.

# Status
ðŸš§ Active development. The pipeline is stable but may evolve as new analyses are incorporated.

If came up any questions, please contact me through janainedpaula@gmail.com. 
